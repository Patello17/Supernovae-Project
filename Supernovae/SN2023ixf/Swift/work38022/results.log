import numpy
from sherpa.astro.ui import *

######### Load Data Sets

load_pha(1, "PC2.pi")
group(1)

######### Data Spectral Responses

load_arf(1, "PC2_exp.arf", resp_id=1)
load_rmf(1, "swxwt0to2s6_20210101v017.rmf", resp_id=1)

######### Load Background Data Sets

load_bkg(1, "PC2back.pi", bkg_id=1)
group(1, bkg_id=1)

######### Background Spectral Responses

load_arf(1, "PC2_exp.arf", resp_id=1, bkg_id=1)
load_rmf(1, "swxwt0to2s6_20210101v017.rmf", resp_id=1, bkg_id=1)

######### Set Energy or Wave Units

set_analysis(1, quantity="energy", type="rate", factor=0)

######### Filter Data

notice_id(1, "0.300000011921:8.000000000000")
notice_id(1, bkg_id=1)
notice_id(1, "0.300000011921:8.000000000000", bkg_id=1)


######### Set Statistic

set_stat("cash")


######### Set Fitting Method

set_method("levmar")

set_method_opt("epsfcn", 1.1920928955078125e-07)
set_method_opt("factor", 100.0)
set_method_opt("ftol", 1.1920928955078125e-07)
set_method_opt("gtol", 1.1920928955078125e-07)
set_method_opt("maxfev", None)
set_method_opt("numcores", 1)
set_method_opt("verbose", 0)
set_method_opt("xtol", 1.1920928955078125e-07)


######### Set Model Components and Parameters

create_model_component("xsvapec", "v1")
v1.integrate = True

v1.kT.default_val = 68.447
v1.kT.default_min = 0.0808
v1.kT.default_max = 68.447
v1.kT.val     = 17.757997658335633
v1.kT.min     = 0.0808
v1.kT.max     = 68.447
v1.kT.units   = "keV"
v1.kT.frozen  = False

v1.He.default_val = 1.0
v1.He.default_min = 0.0
v1.He.default_max = 1000.0
v1.He.val     = 1.0
v1.He.min     = 0.0
v1.He.max     = 1000.0
v1.He.units   = ""
v1.He.frozen  = True

v1.C.default_val = 1.0
v1.C.default_min = 0.0
v1.C.default_max = 1000.0
v1.C.val     = 1.0
v1.C.min     = 0.0
v1.C.max     = 1000.0
v1.C.units   = ""
v1.C.frozen  = True

v1.N.default_val = 1.0
v1.N.default_min = 0.0
v1.N.default_max = 1000.0
v1.N.val     = 1.0
v1.N.min     = 0.0
v1.N.max     = 1000.0
v1.N.units   = ""
v1.N.frozen  = True

v1.O.default_val = 1.0
v1.O.default_min = 0.0
v1.O.default_max = 1000.0
v1.O.val     = 1.0
v1.O.min     = 0.0
v1.O.max     = 1000.0
v1.O.units   = ""
v1.O.frozen  = True

v1.Ne.default_val = 1.0
v1.Ne.default_min = 0.0
v1.Ne.default_max = 1000.0
v1.Ne.val     = 1.0
v1.Ne.min     = 0.0
v1.Ne.max     = 1000.0
v1.Ne.units   = ""
v1.Ne.frozen  = True

v1.Mg.default_val = 1.0
v1.Mg.default_min = 0.0
v1.Mg.default_max = 1000.0
v1.Mg.val     = 1.0
v1.Mg.min     = 0.0
v1.Mg.max     = 1000.0
v1.Mg.units   = ""
v1.Mg.frozen  = True

v1.Al.default_val = 1.0
v1.Al.default_min = 0.0
v1.Al.default_max = 1000.0
v1.Al.val     = 1.0
v1.Al.min     = 0.0
v1.Al.max     = 1000.0
v1.Al.units   = ""
v1.Al.frozen  = True

v1.Si.default_val = 1.0
v1.Si.default_min = 0.0
v1.Si.default_max = 1000.0
v1.Si.val     = 1.0
v1.Si.min     = 0.0
v1.Si.max     = 1000.0
v1.Si.units   = ""
v1.Si.frozen  = True

v1.S.default_val = 1.0
v1.S.default_min = 0.0
v1.S.default_max = 1000.0
v1.S.val     = 1.0
v1.S.min     = 0.0
v1.S.max     = 1000.0
v1.S.units   = ""
v1.S.frozen  = True

v1.Ar.default_val = 1.0
v1.Ar.default_min = 0.0
v1.Ar.default_max = 1000.0
v1.Ar.val     = 1.0
v1.Ar.min     = 0.0
v1.Ar.max     = 1000.0
v1.Ar.units   = ""
v1.Ar.frozen  = True

v1.Ca.default_val = 1.0
v1.Ca.default_min = 0.0
v1.Ca.default_max = 1000.0
v1.Ca.val     = 1.0
v1.Ca.min     = 0.0
v1.Ca.max     = 1000.0
v1.Ca.units   = ""
v1.Ca.frozen  = True

v1.Fe.default_val = 1.0
v1.Fe.default_min = 0.0
v1.Fe.default_max = 1000.0
v1.Fe.val     = 1.0
v1.Fe.min     = 0.0
v1.Fe.max     = 1000.0
v1.Fe.units   = ""
v1.Fe.frozen  = True

v1.Ni.default_val = 1.0
v1.Ni.default_min = 0.0
v1.Ni.default_max = 1000.0
v1.Ni.val     = 1.0
v1.Ni.min     = 0.0
v1.Ni.max     = 1000.0
v1.Ni.units   = ""
v1.Ni.frozen  = True

v1.Redshift.default_val = 0.0
v1.Redshift.default_min = -0.999
v1.Redshift.default_max = 10.0
v1.Redshift.val     = 0.0
v1.Redshift.min     = -0.999
v1.Redshift.max     = 10.0
v1.Redshift.units   = ""
v1.Redshift.frozen  = True

v1.norm.default_val = 1.0
v1.norm.default_min = 0.0
v1.norm.default_max = 1e+24
v1.norm.val     = 7.717152596055026e-05
v1.norm.min     = 0.0
v1.norm.max     = 1e+24
v1.norm.units   = ""
v1.norm.frozen  = False

create_model_component("powlaw1d", "p1")
p1.integrate = True

p1.gamma.default_val = 1.0
p1.gamma.default_min = -10.0
p1.gamma.default_max = 10.0
p1.gamma.val     = 1.866656009624229
p1.gamma.min     = -10.0
p1.gamma.max     = 10.0
p1.gamma.units   = ""
p1.gamma.frozen  = False

p1.ref.default_val = 1.0
p1.ref.default_min = -3.4028234663852886e+38
p1.ref.default_max = 3.4028234663852886e+38
p1.ref.val     = 1.0
p1.ref.min     = -3.4028234663852886e+38
p1.ref.max     = 3.4028234663852886e+38
p1.ref.units   = ""
p1.ref.frozen  = True

p1.ampl.default_val = 1.0
p1.ampl.default_min = 0.0
p1.ampl.default_max = 3.4028234663852886e+38
p1.ampl.val     = 5.5781468209633035e-06
p1.ampl.min     = 0.0
p1.ampl.max     = 3.4028234663852886e+38
p1.ampl.units   = ""
p1.ampl.frozen  = False

create_model_component("xstbabs", "abs1")
abs1.integrate = True

abs1.nH.default_val = 1.9187196949543526
abs1.nH.default_min = 0.0
abs1.nH.default_max = 1000000.0
abs1.nH.val     = 0.43727461793195105
abs1.nH.min     = 0.0767
abs1.nH.max     = 1000000.0
abs1.nH.units   = "10^22 atoms / cm^2"
abs1.nH.frozen  = False



######### Set Source, Pileup and Background Models

set_source(1, xstbabs.abs1 * xsvapec.v1)

set_bkg_source(1, powlaw1d.p1, bkg_id=1)


######### XSPEC Module Settings

set_xschatter(10)
set_xsabund("wilm")
set_xscosmo(70, 0, 0.73)
set_xsxsect("vern")
set_xsxset("APECROOT", "/home/prayag/Software/ciao-4.17/spectral/modelData/apec_v3.0.9")

######### Calculated Fluxes

Absorbed Flux: 1.0525751783216236e-13 +2.3856276093091115e-14, 2.3481134910785154e-14
Unabsorbed Flux: 1.342456686248865e-13 +2.661182838013465e-14, 2.862669135938998e-14

######### Calculated Confidences

datasets    = (1,)
methodname  = confidence
iterfitname = none
fitname     = levmar
statname    = cash
sigma       = 1
percent     = 68.26894921370858
parnames    = ('abs1.nH', 'v1.kT', 'v1.norm', 'p1.gamma', 'p1.ampl')
parvals     = (0.43727461793195105, 17.757997658335633, 7.717152596055026e-05, 1.866656009624229, 5.5781468209633035e-06)
parmins     = (-0.40280480663001134, -15.39740833029967, -3.053772104460424e-05, -0.5421605259946594, -1.9679824371382093e-06)
parmaxes    = (1.4814450770224015, None, 5.985275534037031e-05, 0.5442415173874788, 2.44604123451702e-06)
nfits       = 75

######## Counts and Count Rate

Counts: 19.0
Count Rate: 0.0021683297184994475